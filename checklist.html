<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Checklist de Passagem de Turno - Labortech</title>
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.10/firebase-app.js";
    import { getDatabase, ref, push } from "https://www.gstatic.com/firebasejs/9.6.10/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyCR2jcVUoytPZ6nQUMGKO7Rjx0bLXZmoug",
      authDomain: "abeni-recebimento.firebaseapp.com",
      databaseURL: "https://abeni-recebimento-default-rtdb.firebaseio.com",
      projectId: "abeni-recebimento",
      storageBucket: "abeni-recebimento.appspot.com",
      messagingSenderId: "206597164412",
      appId: "1:206597164412:web:71eb0d2e5d6b13a39028f9"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    window.enviarChecklist = () => {
      const nome = document.getElementById("analista").value.trim();
      const dataHora = new Date().toLocaleString("pt-BR", { timeZone: "America/Sao_Paulo" });
      const observacoes = document.getElementById("observacoes").value.trim();

      if (!nome) {
        alert("Por favor, preencha o nome do analista.");
        return;
      }

      const ocorrencias = [];
      for (let i = 0; i < 27; i++) {
        const sim = document.querySelector(`input[name='item${i}'][value='Sim']:checked`);
        if (sim) {
          const itemLabel = document.getElementById(`label${i}`).innerText;
          ocorrencias.push(itemLabel);
        }
      }

      const dados = {
        analista: nome,
        dataHora: dataHora,
        status: "Finalizado",
        ocorrencias: ocorrencias.join(", "),
        observacoes: observacoes
      };

      push(ref(db, "checklists"), dados).then(() => {
        document.getElementById("checklistForm").reset();
        document.getElementById("dataHora").value = dataHora;
        limparAssinatura();
        document.getElementById("successMsg").style.display = "block";
        setTimeout(() => {
          document.getElementById("successMsg").style.display = "none";
        }, 3000);
      });
    };

    window.abrirHistorico = () => {
      window.open("historico_labortech_completo.html", "_blank");
    };
  </script>
  <style>
    body { font-family: Arial; background: #f4f9ff; margin: 0; padding: 0; }
    header { background: #003366; text-align: center; padding: 10px; }
    header img { max-height: 80px; background: white; padding: 5px; border-radius: 10px; }
    h2 { color: #003366; text-align: center; margin: 20px 0; }
    .container {
      max-width: 900px; margin: auto; background: white; padding: 20px;
      border-radius: 10px; box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
    .item { display: flex; justify-content: space-between; border-bottom: 1px solid #ddd; padding: 8px 0; }
    .options { flex-shrink: 0; }
    label { flex: 1; }
    input, textarea { width: 100%; padding: 10px; margin-top: 10px; border-radius: 6px; border: 1px solid #ccc; }
    canvas { width: 100%; height: 150px; border: 1px solid #ccc; border-radius: 6px; margin-top: 10px; touch-action: none; }
    .btn { background: #003366; color: white; padding: 12px 20px; border: none; border-radius: 8px; margin-top: 20px; cursor: pointer; font-weight: bold; }
    .btn-clear { background: #888; }
    .success { display: none; color: green; text-align: center; font-weight: bold; margin-top: 20px; }
  </style>
</head>
<body>

<header>
  <img src="https://i.imgur.com/qzdrm3E.png" alt="Logo Labortech"/>
</header>

<div class="container">
  <h2>Checklist de Passagem de Turno</h2>
  <form id="checklistForm" onsubmit="event.preventDefault(); enviarChecklist();">
    <label>Nome do Analista:</label>
    <input type="text" id="analista" required />

    <label>Data e Hora:</label>
    <input type="text" id="dataHora" readonly />

    <div id="itensChecklist"></div>

    <label>Observações:</label>
    <textarea id="observacoes" rows="3"></textarea>

    <label>Assinatura:</label>
    <canvas id="signature"></canvas><br/>
    <button type="button" class="btn btn-clear" onclick="limparAssinatura()">Limpar Assinatura</button>
    <button type="submit" class="btn">Iniciar Turno</button>
    <button type="button" class="btn" onclick="abrirHistorico()">Ver Histórico</button>

    <div class="success" id="successMsg">✅ Turno registrado com sucesso!</div>
  </form>
</div>

<script>
  const itens = [
    "Agitador magnético", "Balança Semi-Analítica", "Balança Analítica", "Balança de Umidade",
    "Banho Ultra termostático", "Bomba de Vácuo", "CPU/Monitor/Impressora", "Bombonas 20L e 50L",
    "Pasta de Arquivos FISPQ", "Condutivímetro/Célula", "Deionizador", "Espectrofotômetro/Cubeta",
    "Estufa", "Mesa Agitadora", "Medidor de PH/Eletrodo", "Sacarímetro/Polarímetro",
    "Arquivos reagentes", "Condições de Capela", "Termo Higrômetro", "Vidraria/Acessórios",
    "Cadeira/Bancos", "Armários/Portas", "Energia/Tomadas/Lâmpadas", "Água", "Outros",
    "Material Contenção de Reagentes", "Lava Olhos"
  ];

  const container = document.getElementById("itensChecklist");
  itens.forEach((item, index) => {
    const div = document.createElement("div");
    div.className = "item";
    div.innerHTML = `
      <label id="label${index}">${item}</label>
      <div class="options">
        <label><input type="radio" name="item${index}" value="Sim" required /> Sim</label>
        <label><input type="radio" name="item${index}" value="Não" /> Não</label>
      </div>
    `;
    container.appendChild(div);
  });

  const canvas = document.getElementById("signature");
  const ctx = canvas.getContext("2d");
  let drawing = false;

  canvas.addEventListener("pointerdown", e => {
    drawing = true;
    ctx.beginPath();
    ctx.moveTo(e.offsetX, e.offsetY);
  });
  canvas.addEventListener("pointermove", e => {
    if (!drawing) return;
    ctx.lineTo(e.offsetX, e.offsetY);
    ctx.stroke();
  });
  canvas.addEventListener("pointerup", () => drawing = false);

  function limparAssinatura() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
  }

  document.getElementById("dataHora").value = new Date().toLocaleString("pt-BR", {
    timeZone: "America/Sao_Paulo"
  });
</script>

</body>
</html>
