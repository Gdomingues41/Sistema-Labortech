<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Recebimento de Amostras - Labortech</title>
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.10/firebase-app.js";
    import { getDatabase, ref, push } from "https://www.gstatic.com/firebasejs/9.6.10/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyCR2jcVUoytPZ6nQUMGKO7Rjx0bLXZmoug",
      authDomain: "abeni-recebimento.firebaseapp.com",
      databaseURL: "https://abeni-recebimento-default-rtdb.firebaseio.com",
      projectId: "abeni-recebimento",
      storageBucket: "abeni-recebimento.appspot.com",
      messagingSenderId: "206597164412",
      appId: "1:206597164412:web:71eb0d2e5d6b13a39028f9"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    window.receberAmostra = () => {
      const amostra = document.getElementById("amostra").value.trim();
      const categoria = document.getElementById("categoria").value;
      const recebidoPor = document.getElementById("recebidoPor").value.trim();
      const entreguePor = document.getElementById("entreguePor").value.trim();
      const dataHora = new Date().toLocaleString("pt-BR", { timeZone: "America/Sao_Paulo" });
      const assinatura = document.getElementById("signature").toDataURL();

      if (!amostra || !categoria || !recebidoPor || !entreguePor || assinatura === defaultSignature) {
        alert("Por favor, preencha todos os campos e assine.");
        return;
      }

      const dados = {
        amostra: amostra,
        categoria: categoria,
        recebidoPor: recebidoPor,
        entreguePor: entreguePor,
        dataHora: dataHora,
        assinatura: assinatura,
        status: "Analisando"
      };

      push(ref(db, "recebimentos"), dados).then(() => {
        document.getElementById("formAmostra").reset();
        limparAssinatura();
        document.getElementById("dataHora").value = dataHora;
        document.getElementById("successMsg").style.display = "block";
        setTimeout(() => {
          document.getElementById("successMsg").style.display = "none";
        }, 3000);
      });
    };
  </script>
  <style>
    body { font-family: Arial; background: #f4f9ff; margin: 0; padding: 0; }
    header { background: #003366; text-align: center; padding: 10px; }
    header img { max-height: 80px; background: white; padding: 5px; border-radius: 10px; }
    h2 { color: #003366; text-align: center; margin: 20px 0; }
    .container {
      max-width: 900px; margin: auto; background: white; padding: 20px;
      border-radius: 10px; box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
    label { display: block; margin-top: 10px; font-weight: bold; }
    input, select, textarea {
      width: 100%; padding: 10px; margin-top: 5px; border-radius: 6px; border: 1px solid #ccc;
    }
    canvas {
      width: 100%; height: 150px; border: 1px solid #ccc;
      border-radius: 6px; margin-top: 10px; touch-action: none; background: white;
    }
    .btn {
      background: #003366; color: white; padding: 12px 20px;
      border: none; border-radius: 8px; margin-top: 20px;
      cursor: pointer; font-weight: bold;
    }
    .btn-clear { background: #888; }
    .success {
      display: none; color: green; text-align: center;
      font-weight: bold; margin-top: 20px;
    }
  </style>
</head>
<body>

<header>
  <img src="https://i.imgur.com/qzdrm3E.png" alt="Logo Labortech"/>
</header>

<div class="container">
  <h2>Tela de Recebimento de Amostras</h2>
  <form id="formAmostra" onsubmit="event.preventDefault(); receberAmostra();">
    <label>Amostra:</label>
    <input type="text" id="amostra" required />

    <label>Categoria:</label>
    <select id="categoria" required>
      <option value="">Selecione</option>
      <option value="Açúcar Cristal">Açúcar Cristal</option>
      <option value="Navio Embarque">Navio Embarque</option>
      <option value="Ferrovia">Ferrovia</option>
      <option value="Caminhão Extra">Caminhão Extra</option>
    </select>

    <label>Data e Hora:</label>
    <input type="text" id="dataHora" readonly />

    <label>Recebido por:</label>
    <input type="text" id="recebidoPor" required />

    <label>Entregue por:</label>
    <input type="text" id="entreguePor" required />

    <label>Assinatura:</label>
    <canvas id="signature"></canvas>
    <button type="button" class="btn btn-clear" onclick="limparAssinatura()">Limpar Assinatura</button>

    <button type="submit" class="btn">Receber Amostra</button>
    <div class="success" id="successMsg">✅ Amostra recebida com sucesso!</div>
  </form>
</div>

<script>
  const canvas = document.getElementById("signature");
  const ctx = canvas.getContext("2d");
  let drawing = false;
  let defaultSignature = canvas.toDataURL();

  canvas.addEventListener("pointerdown", e => {
    drawing = true;
    ctx.beginPath();
    ctx.moveTo(e.offsetX, e.offsetY);
  });

  canvas.addEventListener("pointermove", e => {
    if (!drawing) return;
    ctx.lineTo(e.offsetX, e.offsetY);
    ctx.stroke();
  });

  canvas.addEventListener("pointerup", () => drawing = false);

  function limparAssinatura() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
  }

  document.getElementById("dataHora").value = new Date().toLocaleString("pt-BR", {
    timeZone: "America/Sao_Paulo"
  });
</script>

</body>
</html>
